<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Az…ôrbaycan Beyn…ôlxalq Maarif | ƒ∞mtahan N…ôtic…ôsi Sorgulama</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ∆èsas r…ôngl…ôr */
        .bg-primary-dark { background-color: #00525d; }
        .bg-primary-hover { background-color: #003f47; }
        .text-primary-dark { color: #00525d; }
        .border-primary-dark { border-color: #00525d; }
        .focus-ring-primary { --tw-ring-color: #00525d; }
        
        /* √úmumi stil */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            height: 100% !important;
            box-sizing: border-box; 
            overflow-x: hidden;
        }
        
        main {
            min-height: calc(100vh - 78px);
        }

        body {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            background-color: #00525d;
            color: #fcfcfc;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Gec…ô rejimi still…ôri */
        .dark body {
            background-color: #1a202c;
            color: #fcfcfc;
        }

        .dark .header-bg {
             background-color: #2d3748;
        }
        
        .dark .text-header-title {
            color: #fcfcfc;
        }

        .text-tmv {
            color: #4a5568;
        }

        .dark .text-tmv {
            color: #fcfcfc;
        }

        .dark #query-card {
            background-color: #2d3748;
            border: 1px solid #4a5568;
        }

        .dark .form-label {
            color: #fcfcfc;
        }
        
        .dark .form-input-bg {
             background-color: #4a5568;
             color: #fcfcfc;
             border-color: #4a5568;
        }

        .dark .text-primary-dark-override {
            color: #4fd1c5;
        }
        
        .dark .bg-primary-dark-override {
            background-color: #4fd1c5;
        }

        .dark .bg-primary-dark-override:hover {
            background-color: #38b2ac;
        }

        .dark #toast-content {
            background-color: #2d3748;
        }
        
        .logo-border {
            border-color: #00adba;
        }

        .shadow-3xl {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        }

        #resultFrame {
            width: 100%;
            height: 85vh; 
            border: none;
            border-radius: 0.75rem;
        }

        /* X√ºsusi se√ßim (select) sah…ôsinin stili */
        .custom-select-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%23ffffff'%3e%3cpath d='M7 7l3-3 3 3m0 6l-3 3-3-3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-right: 2.5rem; 
        }

        .form-input-bg {
             background-color: #fcfcfc;
             color: #1f2937;
             border: 1px solid #d1d5db;
        }
        
        .dark .custom-select-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%231f2937'%3e%3cpath d='M7 7l3-3 3 3m0 6l-3 3-3-3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath%3e%3c/svg%3e");
        }

        #toast {
            z-index: 100;
        }
        
        /* Ba≈ülƒ±q M…ôtninin √ñl√ß√ºs√º */
        .header-title-text {
            font-size: 1.15rem;
        }

        @media (min-width: 640px) {
            .header-title-text {
                font-size: 1.5rem;
            }
        }

        /* Y√ºkl…ônm…ô Animasiyasƒ± √º√ß√ºn CSS */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-logo {
            animation: spin 1.5s linear infinite;
        }
        
        /* ≈ûagird M…ôlumat Kartƒ± Stili - YENƒ∞L∆èNƒ∞B */
        .student-info-card {
            background: linear-gradient(135deg, #f3f4f6 0%, #ffffff 100%);
            font-family: 'Poppins', sans-serif;
        }
        .dark .student-info-card {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
        }

        /* ≈ûagird m…ôlumatlarƒ± yazƒ± r…ôngl…ôri - YENƒ∞ (TAMAMEN DEƒûƒ∞≈ûTƒ∞Rƒ∞LDƒ∞) */
        /* G√ºnd√ºz modu: mavi (#00525d) arka plan, beyaz yazƒ±lar */
        .student-info-card .bg-white {
            background-color: #00525d !important;
            border-color: #003f47 !important;
        }

        /* √áER√áEVELER ƒ∞√áƒ∞N: G√ºnd√ºz modunda beyaz yazƒ±, Gece modunda beyaz yazƒ± */
        .student-info-card .bg-white span, /* √áer√ßeve i√ßindeki yazƒ±lar */
        .student-info-card .text-xs,       /* "Sinif:", "ID N√∂mr…ôsi:" gibi k√º√ß√ºk yazƒ±lar */
        .student-info-card #student-class,
        .student-info-card #student-id-display,
        .student-info-card #exam-name-display {
            color: #ffffff !important;
        }

        /* ≈ûAGƒ∞RD ADI SOYADI: G√ºnd√ºz modunda siyah, Gece modunda beyaz */
        .student-info-card #student-fullname {
            color: #00525d !important;
        }
        .dark .student-info-card #student-fullname {
            color: #ffffff !important;
        }

        /* "≈ûagirdin Adƒ± v…ô Soyadƒ±" ba≈ülƒ±ƒüƒ±: G√ºnd√ºz modunda gri, Gece modunda gri */
        .student-info-card h4 {
            color: #4a5568 !important;
        }
        .dark .student-info-card h4 {
            color: #cbd5e0 !important;
        }
        
        /* Gec…ô modu: aƒü yazƒ±lar */
        .dark .student-info-card h4,
        .dark .student-info-card #student-fullname,
        .dark .student-info-card #student-class,
        .dark .student-info-card #student-id-display,
        .dark .student-info-card #exam-name-display,
        .dark .student-info-card .text-xs,
        .dark .student-info-card .bg-gray-700 {
            color: #ffffff !important;
        }

        /* Font stilleri */
        .student-info-card h4 {
            font-weight: 500 !important;
        }

        .student-info-card #student-fullname,
        .student-info-card #student-class,
        .student-info-card #student-id-display,
        .student-info-card #exam-name-display {
            font-weight: 600 !important;
        }

        /* G√ºnd√ºz modunda "ƒ∞mtahan" yazƒ±sƒ±nƒ±n rengi - a√ßƒ±k mavi */
        .student-info-card #exam-name-display {
            color: #4fd1c5 !important;
        }

        /* Gec…ô modunda "ƒ∞mtahan" yazƒ±sƒ±nƒ±n rengi - a√ßƒ±k mavi */
        .dark .student-info-card #exam-name-display {
            color: #4fd1c5 !important;
        }

        /* GE√áE/G√úND√úZ D√úƒûMESƒ∞ DAƒ∞RE STƒ∞Lƒ∞ - YENƒ∞ */
        .theme-toggle-circle {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        /* G√ºnd√ºz modu: mavi daire i√ßinde gece d√ºƒümesi */
        .theme-toggle-circle {
            background-color: #00525d;
        }
        
        /* Gece modu: beyaz daire i√ßinde g√ºnd√ºz d√ºƒümesi */
        .dark .theme-toggle-circle {
            background-color: #ffffff;
        }
        
        .theme-toggle-circle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .dark .theme-toggle-circle:hover {
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.15);
        }
        
        /* AY ƒ∞KONU RENGƒ∞ - SON HALƒ∞ */
        #moon-icon, #sun-icon {
            stroke: #ffffff !important;
        }
        
        .dark #moon-icon, .dark #sun-icon {
            stroke: #00525d !important;
        }
        
        /* PAYLA≈ûIM DROPDOWN STƒ∞Lƒ∞ - YENƒ∞ */
        .share-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .share-dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 100;
            border-radius: 0.75rem;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .dark .share-dropdown-content {
            background-color: #2d3748;
            border: 1px solid #4a5568;
        }
        
        .share-dropdown:hover .share-dropdown-content {
            display: block;
        }
        
        .share-option {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0.75rem 1rem;
            text-align: left;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.875rem;
            color: #4a5568;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        
        .dark .share-option {
            color: #cbd5e0;
        }
        
        .share-option:hover {
            background-color: #f7fafc;
        }
        
        .dark .share-option:hover {
            background-color: #4a5568;
        }
        
        .share-option svg {
            margin-right: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
        }

    </style>
</head>
<body class="bg-primary-dark">
    <!-- Ba≈ülƒ±q / Header -->
    <header class="bg-white header-bg shadow-xl relative z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-5">
                <!-- Loqo -->
                <img id="school-logo" 
                     src="https://i.imgur.com/a3FuVV8.png" 
                     alt="Okul Logosu" 
                     class="w-20 h-20 object-contain rounded-full border-2 logo-border p-1"
                     onerror="this.onerror=null; this.src='https://placehold.co/80x80/ccc/333?text=Logo';" 
                />
                <!-- M…ôkt…ôb adƒ± -->
                <div class="flex flex-col items-start leading-tight">
                    <p class="text-base sm:text-lg font-medium text-tmv">
                        üáπüá∑ üá¶üáø T√ºrkiy…ô Maarif V…ôqfi
                    </p>
                    <h1 class="header-title-text font-normal text-gray-900 text-header-title tracking-tight mt-0.5 sm:text-2xl">
                        Az…ôrbaycan Beyn…ôlxalq Maarif M…ôkt…ôbl…ôri
                    </h1>
                    <div class="mt-1 text-xs sm:text-sm text-gray-600 bg-gray-100 dark:bg-gray-700 dark:text-gray-200 px-3 py-0.5 rounded-full font-medium">
                        N…ôsimi Kampusu
                    </div>
                </div>
            </div>
            <!-- Gec…ô/G√ºnd√ºz Rejimi D√ºym…ôsi -->
            <div class="flex items-center space-x-4">
                <div class="theme-toggle-circle">
                    <button id="theme-toggle" onclick="toggleTheme()" class="p-2 rounded-full text-gray-700 dark:text-gray-200 transition duration-300">
                        <svg id="sun-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="moon-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ∆èsas M…ôzmun -->
    <main class="flex flex-col items-center justify-start p-4 sm:p-6 pt-8 sm:pt-12 min-h-screen">
        <!-- N…ôtic…ô Sorgulama Kartƒ± -->
        <div id="query-card" class="w-full max-w-lg bg-white p-8 sm:p-12 rounded-2xl shadow-3xl transition-all duration-300">
            <div class="text-center mb-8">
                <h2 class="text-xl sm:text-2xl font-semibold text-primary-dark text-primary-dark-override mb-3 leading-tight">
                    ƒ∞mtahan N…ôtic…ôl…ôri Yoxlama Sistemin…ô Xo≈ü G…ôlmisiniz!
                </h2>
            </div>
            <form id="resultForm" class="space-y-7" onsubmit="event.preventDefault(); viewResult();">
                <div>
                    <label for="exam" class="block text-sm font-normal text-gray-700 form-label mb-1">ƒ∞mtahanƒ± Se√ßin</label>
                    <div class="relative">
                        <select id="exam" required class="custom-select-icon block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-md form-input-bg focus:outline-none focus:ring-2 focus:ring-[#00525d] focus:ring-offset-0 focus-ring-primary text-base transition duration-150 ease-in-out">
                            <option value="" disabled selected>ƒ∞mtahanƒ± se√ßin</option>
                            <option value="M√∂vzu Sƒ±naƒüƒ± II">M√∂vzu Sƒ±naƒüƒ± II</option>
                            <option value="Ki√ßik Summativ Qiym…ôtl…ôndirm…ô II">Ki√ßik Summativ Qiym…ôtl…ôndirm…ô II</option>
                            <option value="M√∂vzu Sƒ±naƒüƒ± I">M√∂vzu Sƒ±naƒüƒ± I</option>
                            <option value="Ki√ßik Summativ Qiym…ôtl…ôndirm…ô I">Ki√ßik Summativ Qiym…ôtl…ôndirm…ô I</option>
                            <option value="Diaqnostik qiym…ôtl…ôndirm…ô">Diaqnostik qiym…ôtl…ôndirm…ô</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="id" class="block text-sm font-normal text-gray-700 form-label mb-1">≈ûagird ID (Son 6 r…ôq…ôm)</label>
                    <div class="relative">
                        <input type="tel" id="id" required 
                               class="appearance-none block w-full px-4 py-3 rounded-xl shadow-md form-input-bg placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00525d] focus:ring-offset-0 focus-ring-primary text-base transition duration-150 ease-in-out" 
                               placeholder="≈ûagirdin ID n√∂mr…ôsinin son 6 r…ôq…ômi"
                               pattern="\d{6}" 
                               maxlength="6" 
                               inputmode="numeric">
                    </div>
                </div>
                <div>
                    <button type="submit" id="search-btn" class="w-full flex justify-center items-center py-3.5 px-4 border border-transparent rounded-xl shadow-lg text-lg font-normal text-white bg-primary-dark bg-primary-dark-override hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#00525d] transition duration-300 ease-in-out transform hover:scale-[1.01] hover:shadow-xl">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        N…ôtic…ôni Axtar
                    </button>
                </div>
            </form>
        </div>

        <!-- N…ôtic…ô √ñnizl…ôm…ô Konteyneri -->
        <div id="result-container" class="hidden w-full max-w-5xl mt-10 transition-opacity duration-500 opacity-0">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-3xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                <div class="bg-primary-dark bg-primary-dark-override px-6 py-4 border-b border-primary-hover flex flex-wrap justify-between items-center">
                    <h3 class="text-xl font-normal text-white">≈ûagirdin N…ôtic…ôsin…ô Baxƒ±≈ü</h3>
                    <div class="flex space-x-3 mt-2 sm:mt-0">
                        <!-- Payla≈üƒ±m Butonu - YENƒ∞ -->
                        <div class="share-dropdown">
                            <button class="text-sm px-4 py-2 bg-green-600 text-white rounded-lg font-normal hover:bg-green-700 transition flex items-center shadow-md">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                                Payla≈ü
                            </button>
                            <div class="share-dropdown-content">
                                <button class="share-option" onclick="shareResult('whatsapp')">
                                    <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.76.982.998-3.677-.236-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.9 6.994c-.004 5.45-4.438 9.88-9.888 9.88m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.333.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.333 11.893-11.893 0-3.18-1.24-6.162-3.495-8.411"></path></svg>
                                    WhatsApp
                                </button>
                                <button class="share-option" onclick="shareResult('telegram')">
                                    <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.697.064-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.894-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"></path></svg>
                                    Telegram
                                </button>
                                <button class="share-option" onclick="shareResult('facebook')">
                                    <svg class="w-5 h-5 text-blue-700" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg>
                                    Facebook
                                </button>
                                <button class="share-option" onclick="shareResult('twitter')">
                                    <svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.213c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg>
                                    Twitter
                                </button>
                                <button class="share-option" onclick="shareResult('copy')">
                                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                    Linki Kopyala
                                </button>
                            </div>
                        </div>
                        
                        <button onclick="downloadResult()" class="text-sm px-4 py-2 bg-yellow-500 text-gray-900 rounded-lg font-normal hover:bg-yellow-600 transition flex items-center shadow-md transform hover:scale-[1.05]">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            Y√ºkl…ô
                        </button>
                        <button onclick="resetSearch()" class="text-sm px-4 py-2 bg-gray-600 text-white rounded-lg font-normal hover:bg-gray-700 transition flex items-center shadow-md">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                            Yeni Axtarƒ±≈ü
                        </button>
                    </div>
                </div>

                <!-- ≈ûagird M…ôlumatlarƒ± B√∂lm…ôsi (YENƒ∞L∆èNƒ∞B) -->
                <div id="student-info-section" class="p-6 border-b border-gray-200 dark:border-gray-600 student-info-card hidden">
                    <div class="flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-6">
                        <!-- Profil ƒ∞konu (Loqo il…ô d…ôyi≈üdirildi) -->
                        <div class="flex-shrink-0">
                            <img src="https://i.imgur.com/a3FuVV8.png" 
                                 alt="Okul Logosu" 
                                 class="w-16 h-16 object-contain rounded-full border-2 logo-border p-1 shadow-lg"
                                 onerror="this.onerror=null; this.src='https://placehold.co/64x64/ccc/333?text=Logo';" 
                            />
                        </div>
                        <!-- M…ôtn M…ôlumatlarƒ± -->
                        <div class="text-center sm:text-left flex-1">
                            <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide">≈ûagirdin Adƒ± v…ô Soyadƒ±</h4>
                            <p id="student-fullname" class="text-2xl font-bold text-gray-900 dark:text-white mt-1">M…ôlumat tapƒ±lmadƒ±</p>
                            
                            <div class="flex flex-wrap justify-center sm:justify-start gap-4 mt-3">
                                <!-- Sinif -->
                                <div class="bg-white dark:bg-gray-700 px-3 py-1 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Sinif:</span>
                                    <span id="student-class" class="ml-1 font-bold text-gray-800 dark:text-gray-200">--</span>
                                </div>
                                <!-- ID N√∂mr…ôsi -->
                                <div class="bg-white dark:bg-gray-700 px-3 py-1 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">ID N√∂mr…ôsi:</span>
                                    <span id="student-id-display" class="ml-1 font-bold text-gray-800 dark:text-gray-200">--</span>
                                </div>
                                <!-- ƒ∞mtahan Adƒ± (YENƒ∞) -->
                                <div class="bg-white dark:bg-gray-700 px-3 py-1 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">ƒ∞mtahan:</span>
                                    <span id="exam-name-display" class="ml-1 font-bold text-primary-dark text-primary-dark-override">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-2 bg-gray-100 dark:bg-gray-700">
                    <iframe id="resultFrame" src="" allowfullscreen></iframe>
                </div>
            </div>
        </div>

        <!-- Overlay -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden flex-col items-center justify-center">
            <div class="relative flex items-center justify-center">
                <img id="loading-logo" 
                     src="https://i.imgur.com/d0hRX2m.png" 
                     alt="Y√ºkl…ônir" 
                     class="w-28 h-28 object-contain"
                     onerror="this.onerror=null; this.src='https://placehold.co/112x112/ccc/333?text=Logo';" 
                />
            </div>
            <p class="text-white mt-8 text-xl font-normal animate-pulse">N…ôtic…ô axtarƒ±lƒ±r...</p>
            <p class="text-gray-300 mt-2 text-sm font-light">S…ôbriniz √º√ß√ºn t…ô≈ü…ôkk√ºr edirik!</p>
        </div>

        <!-- Toast Bildiri≈ü -->
        <div id="toast" class="fixed top-5 right-5 z-100 hidden transform transition-all duration-500 translate-x-full">
            <div id="toast-content" class="bg-white border-l-8 p-4 rounded-xl shadow-2xl flex items-start min-w-[350px]">
                <div id="toast-icon" class="mr-3 mt-0.5"></div>
                <div class="flex-1">
                    <p id="toast-message" class="text-base font-normal text-gray-800"></p>
                </div>
                <button onclick="hideToast()" class="ml-4 p-1 rounded-full text-red-600 hover:bg-red-100 transition duration-150">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </div>
    </main>

    <script>
        // API URL-l…ôri
        const LOG_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzpUvW4OAhTzuunQCjJw2Ldwd2cZyrDCw88pBD9MKB_oLumwwEPqHBT1Vcd8zK6DMDIFA/exec';
        const RESULT_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzX-Q13oP9_XH-gHobQKqjNmzICQa_maDt4cbVNRAsDHkLZRHDgeQw2bqYq0pYSuY38/exec";
        
        let lastPreviewUrl = "";
        let toastTimeout;
        const TOAST_DURATION = 5000;
        let currentStudentData = null;
        let currentExamName = "";

        // --- ≈ûAGƒ∞RD M∆èLUMAT BAZASI (TAM YENƒ∞L∆èNƒ∞B) ---
        const studentData = {
             "759382": { name: "Allahverdi ƒ∞smail", class: "3A" },
"103947": { name: "C…ôf…ôrzad…ô Suada", class: "3A" },
"582016": { name: "Xanki≈üiyev Fateh", class: "3A" },
"490273": { name: "ƒ∞manlƒ± ∆èli", class: "3A" },
"816495": { name: "ƒ∞smayƒ±lova Ai≈ü…ô", class: "3A" },
"237580": { name: "Qarayeva Z…ôhra", class: "3A" },
"905621": { name: "M…ômm…ôdli C…ôlal", class: "3A" },
"374812": { name: "M…ômm…ôdzad…ô ∆èslinur", class: "3A" },
"618493": { name: "M…ômm…ôdzad…ô Mahinur", class: "3A" },
"250179": { name: "Muradlƒ± √ñm…ôr", class: "3A" },
"491036": { name: "Musayev C…ôsur", class: "3A" },
"807251": { name: "Novruzlu X…ôdic…ô", class: "3A" },
"364720": { name: "R…ôhimli R√ºst…ôm", class: "3A" },
"593481": { name: "S…ôrdar Mehdi", class: "3A" },
"178409": { name: "∆èliyeva ƒ∞nci", class: "3B" },
"640523": { name: "∆èliyeva ≈û…ôms", class: "3B" },
"927184": { name: "∆èlizad…ô H√ºmeyra", class: "3B" },
"301576": { name: "∆èmirov Ali", class: "3B" },
"485092": { name: "H√ºseynzad…ô Enes", class: "3B" },
"762401": { name: "Karau√ßoƒülu Alparslan", class: "3B" },
"819630": { name: "Kayƒ±k√ßƒ±oƒülu √ñm…ôr Aras", class: "3B" },
"253914": { name: "Kazƒ±m M…ôtin", class: "3B" },
"470185": { name: "Qayƒ±blƒ± Altay", class: "3B" },
"694328": { name: "M…ômm…ôdzad…ô ∆èhm…ôd", class: "3B" },
"135970": { name: "Musavi H…ôs…ôn", class: "3B" },
"280461": { name: "S…ôf…ôrli Onur", class: "3B" },
"956327": { name: "V…ôli D…ôfn…ô", class: "3B" },
"473198": { name: "Bekta≈üoƒülu Zelihanur", class: "4A" },
"612495": { name: "∆èliyeva N…ôzak…ôt", class: "4A" },
"804716": { name: "∆ès…ôdli Zeyn…ôb", class: "4A" },
"159208": { name: "H√ºseynzad…ô Melissa", class: "4A" },
"347590": { name: "Xanki≈üiyeva ƒ∞layda", class: "4A" },
"580246": { name: "ƒ∞brahimov Ziya", class: "4A" },
"921637": { name: "Quluzad…ô Murad", class: "4A" },
"430785": { name: "M…ômm…ôdova Aylin", class: "4A" },
"267914": { name: "Musavi N√ºman", class: "4A" },
"805316": { name: "Musayev Adil", class: "4A" },
"149027": { name: "Musa-zad…ô Ayxan", class: "4A" },
"376582": { name: "V…ôlizad…ô ƒ∞smayƒ±l", class: "4A" },
"602493": { name: "Aƒüayeva Fidan", class: "4B" },
"250398": { name: "Bayramov Uƒüur", class: "4B" },
"683147": { name: "G√∂y√º≈üzad…ô Ayan", class: "4B" },
"107582": { name: "ƒ∞brahimova ƒ∞p…ôk", class: "4B" },
"592364": { name: "Q…ômb…ôrli Z…ôhra", class: "4B" },
"834197": { name: "Mehdizad…ô Aysel", class: "4B" },
"461205": { name: "M…ômm…ôdli Emil", class: "4B" },
"708913": { name: "Musayev Fateh", class: "4B" },
"129684": { name: "N…ôsirov Nihad", class: "4B" },
"354270": { name: "Z√ºlf√ºqarlƒ± Hicran", class: "4B" },
"619485": { name: "Aƒüazad…ô Z…ôhra", class: "5A" },
"914076": { name: "Baxƒ±≈ülƒ± Suada", class: "5A" },
"872031": { name: "√áokal Elif Ece", class: "5A" },
"240597": { name: "∆èbd√ºlsalamova M√ºjgan", class: "5A" },
"503618": { name: "∆èliyeva Banu", class: "5A" },
"976204": { name: "ƒ∞mamzad…ô X…ôdic…ô", class: "5A" },
"381695": { name: "ƒ∞smayƒ±lov √áingiz", class: "5A" },
"147082": { name: "Karata≈ü Elif Nur", class: "5A" },
"650493": { name: "Qasƒ±mova Aylin", class: "5A" },
"812736": { name: "Mehdizad…ô Fidan", class: "5A" },
"295041": { name: "M…ômm…ôdova G√ºlay", class: "5A" },
"470286": { name: "M…ôsimli Zeyn…ôb", class: "5A" },
"598314": { name: "Musayev Fateh", class: "5A" },
"136975": { name: "M√ºsl√ºm M…ôry…ôm", class: "5A" },
"407218": { name: "Novruzlu Kadir", class: "5A" },
"695082": { name: "R…ôsulov Camal", class: "5A" },
"230491": { name: "Sadmaliyeva Sara", class: "5A" },
"872604": { name: "Salmanov √ñm…ôr", class: "5A" },
"510738": { name: "Z…ôbiyeva Niluf…ôr", class: "5A" },
"349216": { name: "Aƒüayev √ñm…ôr", class: "5B" },
"706529": { name: "∆èhm…ôdli R…ô≈üid", class: "5B" },
"481032": { name: "∆èhm…ôdov Nazim", class: "5B" },
"920674": { name: "∆èlizad…ô Amal", class: "5B" },
"157843": { name: "H√ºseynli ≈û…ôbn…ôm", class: "5B" },
"634281": { name: "H√ºseynli Zeyn…ôb", class: "5B" },
"805392": { name: "I≈üƒ±lak Esmanur", class: "5B" },
"241067": { name: "ƒ∞sg…ônd…ôrli ƒ∞layda", class: "5B" },
"578193": { name: "ƒ∞smayƒ±lov M…ôhy…ôddin", class: "5B" },
"902746": { name: "M…ômm…ôdli Aida", class: "5B" },
"316085": { name: "M…ômm…ôdova M…ôry…ôm", class: "5B" },
"479320": { name: "M…ômm…ôdzad…ô Amin…ô", class: "5B" },
"150287": { name: "Osmanlƒ± ƒ∞nci", class: "5B" },
"397614": { name: "Pa≈üa Mahmud", class: "5B" },
"521083": { name: "Rayi M…ôry…ôm Niluf…ôr", class: "5B" },
"860472": { name: "Surxayzad…ô X…ôdic…ô", class: "5B" },
"273915": { name: "Yunus ƒ∞nci", class: "5B" },
"409678": { name: "Calalova M…ôry…ôm", class: "6A" },
"735124": { name: "C…ôf…ôrzad…ô Atilla", class: "6A" },
"608391": { name: "∆èhm…ôdli M…ôry…ôm", class: "6A" },
"254087": { name: "∆èlizad…ô Aylin", class: "6A" },
"491630": { name: "ƒ∞mamzad…ô Fatim…ô", class: "6A" },
"876204": { name: "ƒ∞smayƒ±llƒ± Xalid", class: "6A" },
"312597": { name: "Kazƒ±mlƒ± Ceyla", class: "6A" },
"540286": { name: "Q…ônb…ôrli Turqut", class: "6A" },
"729814": { name: "Manaflƒ± Murad", class: "6A" },
"183057": { name: "M…ômm…ôdli F…ôrhad", class: "6A" },
"406291": { name: "M…ômm…ôdli H√ºseyn", class: "6A" },
"598327": { name: "Muradova Selcan", class: "6A" },
"274068": { name: "Naƒüƒ±yev S…ôyyad", class: "6A" },
"815439": { name: "Osmanova M…ôry…ôm", class: "6A" },
"103952": { name: "S…ôrdarlƒ± X…ôdic…ô", class: "6A" },
"642708": { name: "Sultanov Fateh", class: "6A" },
"379164": { name: "T…ôhm…ôzli Mete", class: "6A" },
"587231": { name: "V…ôliyeva Z…ôhra", class: "6A" },
"920648": { name: "Alqayeva Kamil…ô", class: "6B" },
"136785": { name: "Eyvazova M…ôry…ôm", class: "6B" },
"472509": { name: "∆èhm…ôdov Az…ôr", class: "6B" },
"603821": { name: "∆èlirzayev H…ôs…ôn", class: "6B" },
"815430": { name: "∆èsg…ôrova Aylin", class: "6B" },
"257694": { name: "H…ô≈üimli Zeyn…ôb", class: "6B" },
"490862": { name: "H√ºseynli Mustafa", class: "6B" },
"731045": { name: "H√ºseynli Z…ôhra", class: "6B" },
"602198": { name: "ƒ∞smayƒ±l Ayxan", class: "6B" },
"149376": { name: "ƒ∞smayƒ±lzad…ô Mikayƒ±l", class: "6B" },
"384072": { name: "Mahmudlu Altay", class: "6B" },
"526194": { name: "Mahmudova Z√ºmr√ºd", class: "6B" },
"871430": { name: "M…ômm…ôdli Aƒüa", class: "6B" },
"310685": { name: "M…ômm…ôdova L…ôman", class: "6B" },
"479206": { name: "Mustafa Muhammed", class: "6B" },
"695314": { name: "Namazlƒ± Banu", class: "6B" },
"123987": { name: "Pa≈üazad…ô X…ôdic…ô", class: "6B" },
"450678": { name: "≈ûahm…ôrdanov Ramal", class: "6B" },
"807145": { name: "Aƒüayeva ∆èziz…ô", class: "7A" },
"256093": { name: "∆èliyev Yusif", class: "7A" },
"591427": { name: "G√∂y√º≈ül√º Ai≈ü…ô", class: "7A" },
"843210": { name: "H√ºseynli ∆èmin…ô", class: "7A" },
"317596": { name: "ƒ∞brahimov √ñm…ôr", class: "7A" },
"482063": { name: "Karahan Taha", class: "7A" },
"748931": { name: "Q…ôdm…ôliyev Murad", class: "7A" },
"709815": { name: "Q…ôhr…ômanova Q…ôm…ôr", class: "7A" },
"154320": { name: "Quliyev Asim", class: "7A" },
"386297": { name: "Quliyev √ñm…ôr", class: "7A" },
"620514": { name: "Quluzad…ô ∆èhm…ôd", class: "7A" },
"971430": { name: "M…ômm…ôdzad…ô Mustafa", class: "7A" },
"245086": { name: "Namazlƒ± Zeyn…ôb", class: "7A" },
"617903": { name: "Pa≈üazad…ô M…ôdin…ô", class: "7A" },
"507312": { name: "R…ôfiyeva Z…ôhra", class: "7A" },
"863429": { name: "Abdullayev ƒ∞sk…ônd…ôr", class: "7B" },
"139506": { name: "Cenikoƒülu Kaan", class: "7B" },
"472380": { name: "Eyvazova Z…ôhra", class: "7B" },
"685214": { name: "∆ès…ôdullazad…ô Nur", class: "7B" },
"518406": { name: "H…ô≈üimli ≈û…ôms", class: "7B" },
"792631": { name: "Quluzad…ô ƒ∞lkin", class: "7B" },
"346205": { name: "Mehdizad…ô Ramin", class: "7B" },
"479130": { name: "N…ôsibli Mehriban", class: "7B" },
"608492": { name: "N…ôsibov Elcan", class: "7B" },
"251078": { name: "Novruzov R√∂v≈ü…ôn", class: "7B" },
"824516": { name: "T…ôhm…ôzli X…ôlil", class: "7B" },
"130497": { name: "V…ôlizad…ô Ayxan", class: "7B" },
"472861": { name: "Zalov Levent", class: "7B" },
"748206": { name: "Calalova Zeyn…ôb", class: "8A" },
"698205": { name: "C…ôf…ôrli Cavidan", class: "8A" },
"341607": { name: "∆èhm…ôdov H√ºseyn", class: "8A" },
"509382": { name: "H√ºseynli Fatim…ô", class: "8A" },
"872054": { name: "K…ôrimli F…ôrhad", class: "8A" },
"263491": { name: "Quluzad…ô N…ôzrin", class: "8A" },
"504318": { name: "Manaflƒ± M√ºrs…ôl", class: "8A" },
"739205": { name: "M…ômm…ôdov Tuncay", class: "8A" },
"182046": { name: "M…ômm…ôdzad…ô Nuriyy…ô", class: "8A" },
"467193": { name: "N…ôsibli Cavan≈üir", class: "8A" },
"407905": { name: "N…ôzirli Uƒüur", class: "8A" },
"591628": { name: "Novruzlu Elcan", class: "8A" },
"274093": { name: "Cahangirov G√ºnd√ºz", class: "8B" },
"860471": { name: "∆èhm…ôdov M…ôh…ômm…ôd", class: "8B" },
"315208": { name: "∆èkb…ôrli √ñm…ôr", class: "8B" },
"487362": { name: "∆èlizad…ô Cavad", class: "8B" },
"703914": { name: "Hacƒ±yev Cavan≈üir", class: "8B" },
"156024": { name: "H…ôs…ônova Nurg√ºl", class: "8B" },
"392186": { name: "H√ºseynli Leyla", class: "8B" },
"625470": { name: "ƒ∞smayƒ±lzad…ô S…ôdi", class: "8B" },
"981236": { name: "Quluzad…ô Safiyy…ô", class: "8B" },
"247053": { name: "M…ôlikova Aylin", class: "8B" },
"513698": { name: "Musayeva Fidan", class: "8B" },
"867402": { name: "Sultanova Fatim…ô", class: "8B" },
"139587": { name: "≈û…ôrifova ≈û…ôrqiyy…ô", class: "8B" },
"470291": { name: "Abbaslƒ± Ruq…ôyya", class: "9A" },
"681304": { name: "∆èhm…ôdli G√ºlbahar", class: "9A" },
"205473": { name: "∆èlizad…ô Pakiz…ô", class: "9A" },
"529140": { name: "∆èmirov Amin", class: "9A" },
"790631": { name: "H√ºseynli D…ôniz", class: "9A" },
"341276": { name: "ƒ∞brahimov Ayaz", class: "9A" },
"456920": { name: "Mahmudov Xalid", class: "9A" },
"603782": { name: "M…ômm…ôdzad…ô K√ºrs√ºm", class: "9A" },
"218497": { name: "M√ºt…ôllimli Selcan", class: "9A" },
"574130": { name: "Zalova S√ºheyla", class: "9A" },
"802964": { name: "Zeynalov ƒ∞brahim", class: "9A" },
"371805": { name: "∆èsg…ôrova L…ôman", class: "9B" },
"490263": { name: "M…ômm…ôdxanlƒ± Aslan", class: "9B" },
"678124": { name: "M…ômm…ôdova Nuray", class: "9B" },
"135079": { name: "Murad Renat", class: "9B" },
"402185": { name: "Novruzlu N√ºbar", class: "9B" },
"569371": { name: "V…ôlizad…ô ƒ∞nci", class: "9B" },
};

        function playSuccessTone() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (!audioContext) return;
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.type = 'triangle';
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                oscillator.frequency.setValueAtTime(784, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.15);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.15);
                oscillator.frequency.setValueAtTime(1047, audioContext.currentTime + 0.15);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.20);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.35);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.4);
            } catch (e) { console.error("S…ôs x…ôtasƒ±:", e); }
        }

        function playErrorTone() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (!audioContext) return;
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.4, audioContext.currentTime + 0.01);
                oscillator.frequency.setValueAtTime(261, audioContext.currentTime);
                oscillator.frequency.linearRampToValueAtTime(196, audioContext.currentTime + 0.3);
                gainNode.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.3);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.4);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.4);
            } catch (e) { console.error("S…ôs x…ôtasƒ±:", e); }
        }
        
        function hideToast() {
            const toast = document.getElementById('toast');
            clearTimeout(toastTimeout);
            toast.classList.add('translate-x-full');
            setTimeout(() => toast.classList.add('hidden'), 500); 
        }

        function showNotification(message, type = 'info', autoHide = true) {
            clearTimeout(toastTimeout); 
            
            const toast = document.getElementById('toast');
            const content = document.getElementById('toast-content');
            const msgEl = document.getElementById('toast-message');
            const iconEl = document.getElementById('toast-icon');

            msgEl.textContent = message;
            
            let borderColor, iconHtml;

            if (type === 'success' || type === 'announcement' || type === 'info') playSuccessTone();
            else if (type === 'error') playErrorTone();

            if (type === 'success') {
                borderColor = 'border-green-500';
                iconHtml = '<svg class="w-7 h-7 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            } else if (type === 'error') {
                borderColor = 'border-red-500';
                iconHtml = '<svg class="w-7 h-7 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            } else if (type === 'announcement') {
                borderColor = 'border-yellow-500'; 
                iconHtml = '<span class="text-3xl">üîî</span>';
            } else {
                borderColor = 'border-blue-500';
                iconHtml = '<svg class="w-7 h-7 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            }
            
            const isDark = document.documentElement.classList.contains('dark');
            const bgColor = isDark ? 'bg-gray-800' : 'bg-white';
            const textColor = isDark ? 'text-gray-200' : 'text-gray-800';
            
            content.className = `${bgColor} border-l-8 ${borderColor} p-4 rounded-xl shadow-2xl flex items-start min-w-[350px]`;
            msgEl.className = `text-base font-normal ${textColor}`;
            iconEl.innerHTML = iconHtml;
            
            toast.classList.add('translate-x-full');
            toast.classList.remove('hidden'); 
            setTimeout(() => toast.classList.remove('translate-x-full'), 10);

            if (autoHide) {
                toastTimeout = setTimeout(() => hideToast(), TOAST_DURATION); 
            }
        }
        
        function setInitialTheme() {
            // √ñnce localStorage'dan kontrol et
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            let isDarkMode;
            
            if (savedTheme) {
                // Kullanƒ±cƒ± tercihi varsa onu kullan
                isDarkMode = savedTheme === 'dark';
            } else {
                // Yoksa sistem tercihini kullan (OTOMATƒ∞K MOD)
                isDarkMode = prefersDark;
            }
            
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            updateThemeIcons(isDarkMode);
            // localStorage'a kaydet
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        }

        function updateThemeIcons(isDark) {
            document.getElementById('sun-icon').classList.toggle('hidden', isDark);
            document.getElementById('moon-icon').classList.toggle('hidden', !isDark);
        }

        function toggleTheme() {
            const wasDark = document.documentElement.classList.contains('dark');
            const isDark = !wasDark;
            
            document.documentElement.classList.toggle('dark', isDark);
            updateThemeIcons(isDark);
            
            // Kullanƒ±cƒ± tercihini localStorage'a kaydet
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            showNotification(isDark ? "Gec…ô rejimi aktivl…ô≈üdirildi." : "G√ºnd√ºz rejimi aktivl…ô≈üdirildi.", 'info'); 
        }

        function startLoadingAnimation() {
            document.getElementById('loading-logo').classList.add('loading-logo');
        }

        function stopLoadingAnimation() {
            document.getElementById('loading-logo').classList.remove('loading-logo');
        }

        // PAYLA≈ûIM FONKSƒ∞YONU - YENƒ∞
        function shareResult(platform) {
            if (!currentStudentData || !lastPreviewUrl) {
                showNotification("Payla≈ümak i√ßin √∂nce bir sonu√ß g√∂r√ºnt√ºleyin.", "error");
                return;
            }
            
            const studentName = currentStudentData.name;
            const studentClass = currentStudentData.class;
            const studentId = document.getElementById("student-id-display").textContent;
            const examName = currentExamName;
            
            const shareText = `üéì ${studentName} (${studentClass}) adlƒ± ≈üagirdin "${examName}" imtahan n…ôtic…ôsi:\n\n` +
                            `üìä N…ôtic…ôy…ô buradan baxa bil…ôrsiniz:\n${lastPreviewUrl}\n\n` +
                            `üè´ Az…ôrbaycan Beyn…ôlxalq Maarif M…ôkt…ôbl…ôri - N…ôsimi Kampusu`;
            
            const encodedText = encodeURIComponent(shareText);
            const encodedUrl = encodeURIComponent(lastPreviewUrl);
            
            let shareUrl = "";
            
            switch(platform) {
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodedText}`;
                    break;
                case 'telegram':
                    shareUrl = `https://t.me/share/url?url=${encodedUrl}&text=${encodedText}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}&quote=${encodedText}`;
                    break;
                case 'twitter':
                    const twitterText = encodeURIComponent(`${studentName} - ${examName} n…ôtic…ôsi`);
                    shareUrl = `https://twitter.com/intent/tweet?text=${twitterText}&url=${encodedUrl}`;
                    break;
                case 'copy':
                    navigator.clipboard.writeText(shareText)
                        .then(() => showNotification("Payla≈üƒ±m linki kopyalandƒ±!", "success"))
                        .catch(() => showNotification("Kopyalama ba≈üarƒ±sƒ±z!", "error"));
                    return;
                default:
                    return;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
                showNotification(`${platform.charAt(0).toUpperCase() + platform.slice(1)}'da payla≈üƒ±m sayfasƒ± a√ßƒ±ldƒ±.`, "info");
            }
        }

        async function viewResult() {
            const idInput = document.getElementById("id");
            const examSelect = document.getElementById("exam");
            
            const idValue = idInput.value.trim();
            const examValue = examSelect.value;
            const examText = examSelect.options[examSelect.selectedIndex].text;

            if (!idValue || !examValue) {
                showNotification("Z…ôhm…ôt olmasa imtahan n√∂v√ºn√º se√ßin v…ô ≈ûagird ID-ni daxil edin.", "error");
                return;
            }

            const sixDigitRegex = /^\d{6}$/i;
            if (!sixDigitRegex.test(idValue)) {
                showNotification("≈ûagird ID yalnƒ±z 6 r…ôq…ômd…ôn ibar…ôt olmalƒ±dƒ±r.", "error");
                return;
            }
            
            // ≈ûagird m…ôlumatƒ±nƒ± yoxlamaq
            const student = studentData[idValue];
            if (!student) {
                showNotification(`"${idValue}" ID n√∂mr…ôli ≈üagird bazada tapƒ±lmadƒ±. Z…ôhm…ôt olmasa ID-ni yoxlayƒ±n.`, "error");
                return;
            }

            // Mevcut √∂ƒürenci verilerini kaydet
            currentStudentData = student;
            currentExamName = examText;

            const overlay = document.getElementById("overlay");
            const resultContainer = document.getElementById("result-container");
            const studentInfoSection = document.getElementById("student-info-section");

            resultContainer.classList.add("opacity-0", "hidden"); 
            overlay.classList.remove("hidden");
            overlay.classList.add("flex");
            startLoadingAnimation();

            try {
                // API-d…ôn n…ôtic…ôni yoxlayƒ±r
                const response = await fetch(RESULT_SCRIPT_URL + "?id=" + encodeURIComponent(idValue) + "&exam=" + encodeURIComponent(examValue));
                const data = await response.json();

                stopLoadingAnimation();

                // Loglamanƒ± fon rejimind…ô edirik
                fetch(LOG_SCRIPT_URL, {
                    method: 'POST',
                    body: new URLSearchParams({
                        'id': idValue,
                        'exam': examValue,
                        'status': data.status === 'found' ? 'N…ôtic…ô tapƒ±ldƒ±' : 'N…ôtic…ô tapƒ±lmadƒ±'
                    })
                }).catch(e => console.error("Log error", e));

                setTimeout(() => {
                    overlay.classList.add("hidden");
                    overlay.classList.remove("flex");

                    if (data.status === "found" && data.preview) {
                        // YENƒ∞: Sƒ±nav adƒ±nƒ± da bildiri≈ü mesajƒ±na ekle
                        showNotification(`"${student.name}" √º√ß√ºn "${examText}" n…ôtic…ôsi uƒüurla tapƒ±ldƒ±!`, "success");
                        
                        lastPreviewUrl = data.preview;
                        document.getElementById("resultFrame").src = data.preview;

                        // --- ≈ûAGƒ∞RD V∆è ƒ∞MTAHAN M∆èLUMATINI YERL∆è≈ûDƒ∞R (YENƒ∞L∆èNƒ∞B) ---
                        document.getElementById("student-fullname").textContent = student.name;
                        document.getElementById("student-class").textContent = student.class;
                        document.getElementById("student-id-display").textContent = idValue;
                        document.getElementById("exam-name-display").textContent = examText; 
                        
                        studentInfoSection.classList.remove("hidden");

                        resultContainer.classList.remove("hidden");
                        setTimeout(() => resultContainer.classList.remove("opacity-0"), 50);
                        resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

                    } else {
                        showNotification(`"${student.name}" ≈üagirdi √º√ß√ºn "${examText}" n…ôtic…ôsi tapƒ±lmadƒ±.`, "error");
                        studentInfoSection.classList.add("hidden"); // M…ôlumat tapƒ±lmadƒ±sa m…ôlumat kartƒ±nƒ± gizl…ôt
                    }
                }, 500); 

            } catch (error) {
                stopLoadingAnimation();
                console.error("Fetch x…ôtasƒ±:", error);
                overlay.classList.add("hidden");
                overlay.classList.remove("flex"); 
                showNotification("Sistem x…ôtasƒ± ba≈ü verdi.", "error");
            }
        }

        function resetSearch() {
            const resultContainer = document.getElementById("result-container");
            const resultFrame = document.getElementById("resultFrame");

            resultContainer.classList.add("opacity-0");
            setTimeout(() => {
                resultContainer.classList.add("hidden");
                resultFrame.src = "";
                lastPreviewUrl = "";
                document.getElementById("resultForm").reset();
                // T…ômizl…ôy…ônd…ô m…ôlumat kartƒ±nƒ± da gizl…ôt
                document.getElementById("student-info-section").classList.add("hidden");
                showNotification("Axtarƒ±≈ü n…ôtic…ôsi gizl…ôdildi.", "info");
            }, 300);
            
            // Payla≈üƒ±m verilerini temizle
            currentStudentData = null;
            currentExamName = "";
        }

        function downloadResult() {
            if(lastPreviewUrl && lastPreviewUrl !== "about:blank") {
                window.open(lastPreviewUrl, '_blank');
            } else {
                showNotification("Y√ºkl…ôm…ôk √º√ß√ºn …ôvv…ôlc…ô bir n…ôtic…ô tapƒ±lmalƒ±dƒ±r.", "error");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            setInitialTheme();
            
            // Sistem temasƒ± deƒüi≈ütiƒüinde otomatik g√ºncelle (sadece kullanƒ±cƒ± tercihi yoksa)
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    const isDark = e.matches;
                    document.documentElement.classList.toggle('dark', isDark);
                    updateThemeIcons(isDark);
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                    showNotification(isDark ? "Sistem gece moduna ge√ßti." : "Sistem g√ºnd√ºz moduna ge√ßti.", 'info');
                }
            });
            
            setTimeout(() => {
                showNotification("KSQ-2 v…ô MS-2 imtahanlarƒ±nƒ±n n…ôtic…ôl…ôri elan edilmi≈üdir!", 'announcement'); 
            }, 500);

            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const activeElement = document.activeElement;
                    if (activeElement.tagName === 'INPUT' || activeElement.tagName === 'SELECT') {
                        e.preventDefault(); 
                        document.getElementById('search-btn').click();
                    }
                }
            });
            
            // Dropdown dƒ±≈üƒ±nda tƒ±klayƒ±nca kapat
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.share-dropdown')) {
                    const dropdowns = document.querySelectorAll('.share-dropdown-content');
                    dropdowns.forEach(dropdown => {
                        dropdown.style.display = 'none';
                    });
                }
            });
        });
    </script>
</body>
</html>
